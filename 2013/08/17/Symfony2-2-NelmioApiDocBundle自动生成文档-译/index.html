<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Symfony2 (2) - NelmioApiDocBundle自动生成文档(译) · Zhipeng Jiang</title><meta name="description" content="Symfony2 (2) - NelmioApiDocBundle自动生成文档(译) - Zhipeng Jiang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jesusjzp" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/zp-j" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Symfony2 (2) - NelmioApiDocBundle自动生成文档(译)</h1><div class="post-time">Aug 17, 2013</div><div class="post-content"><h1 id="NelmioApiDocBundle"><a href="#NelmioApiDocBundle" class="headerlink" title="NelmioApiDocBundle"></a>NelmioApiDocBundle</h1><p>NelmioApiDocBundle是一个开源的Symfony组建，能够自动生成每个bundle以及内部每个action的document，并支持sandbox测试，可以手动变量输入，非常方便api的开发。</p>
<p>Github的地址是 <a href="https://github.com/nelmio/NelmioApiDocBundle" target="_blank" rel="external">https://github.com/nelmio/NelmioApiDocBundle</a>.</p>
<h1 id="如何安装"><a href="#如何安装" class="headerlink" title="如何安装"></a>如何安装</h1><p>把下面的代码添加到<code>composer.json</code>文件中</p>
<pre><code>{
    &quot;require&quot;: {
        &quot;nelmio/api-doc-bundle&quot;: &quot;dev-master&quot;
    }
}
`&lt;/pre&gt;

在内核文件中`app/AppKernel.php`添加相应的bundle信息

&lt;pre&gt;`// app/AppKernel.php
public function registerBundles()
{
    return array(
        // ...
        new Nelmio\ApiDocBundle\NelmioApiDocBundle(),
    );
}
`&lt;/pre&gt;

修改路由配置文件`routing.yml`，添加路径，以后就可以通过`api/doc`直接访问

&lt;pre&gt;`# app/config/routing.yml
NelmioApiDocBundle:
    resource: &quot;@NelmioApiDocBundle/Resources/config/routing.yml&quot;
    prefix:   /api/doc
`&lt;/pre&gt;

修改配置文件`app/config/config.yml`，使其生效:

&lt;pre&gt;`# app/config/config.yml
nelmio_api_doc: ~
</code></pre><h1 id="具体在代码中如何添加"><a href="#具体在代码中如何添加" class="headerlink" title="具体在代码中如何添加"></a>具体在代码中如何添加</h1><p>我们平时做开发最头疼的一个问题就是如何使得文档能够跟开发保持同步，如果修改文档也像修改代码那样频繁，一定需要花费大量的时间和精力去维护。这就是为什么我推荐<strong>NelmioApiDocBundle</strong>自动文档生成工具。</p>
<p>所有的API接口都写在代码的annotation中，非常方便。</p>
<p>(由此可见，我们的代码的注释也不一定是完全没有用的，这一点在其他语言里体现的也比较多，比如java。)</p>
<h2 id="ApiDoc-注释"><a href="#ApiDoc-注释" class="headerlink" title="ApiDoc() 注释"></a>ApiDoc() 注释</h2><p>这个bundle为你的每个controller提供了<code>ApiDoc()</code>annotation</p>
<pre class="prettyprint linenums">
&lt;?php

namespace Your\Namespace;

use Nelmio\ApiDocBundle\Annotation\ApiDoc;

class YourController extends Controller
{
    /**
     * This the documentation description of your method, it will appear
     * on a specific pane. It will read all the text until the first
     * annotation.
     *
     * @ApiDoc(
     *  resource=true,
     *  description="This is a description of your API method",
     *  filters={
     *      {"name"="a-filter", "dataType"="integer"},
     *      {"name"="another-filter", "dataType"="string", "pattern"="(foo|bar) ASC|DESC"}
     *  }
     * )
     */
    public function getAction()
    {
    }

    /**
     * @ApiDoc(
     *  description="Create a new Object",
     *  input="Your\Namespace\Form\Type\YourType",
     *  output="Your\Namespace\Class"
     * )
     */
    public function postAction()
    {
    }
}
?&gt;
</pre>

<p>在注释部分，有以下几个属性我们可以使用:</p>
<ul>
<li><p><code>section</code>: 允许给资源分组</p>
</li>
<li><p><code>resource</code>: 是否这个函数描述了一个主要资源，默认是否</p>
</li>
<li><p><code>description</code>: 用来描述当前的函数</p>
</li>
<li><p><code>deprecated</code>: 允许把当前函数设置成deprecated，默认是否</p>
</li>
<li><p><code>filters</code>: 一个过滤数组</p>
</li>
<li><table><br>  <tbody><br>    <tr><br>      <td><code>input</code>: the input type associated to the method (currently this supports Form Types, classes with JMS Serializer metadata, and classes with Validation component metadata) useful for POST</td><br>      <td>PUT methods, either as FQCN or as form type (if it is registered in the form factory in the container).</td><br>    </tr><br>  </tbody><br></table></li>
<li><p><code>output</code>: the output type associated with the response.  Specified and parsed the same way as <code>input</code>.</p>
</li>
<li><p><code>statusCodes</code>: 状态码，如404，500等。比如下面的代码，</p>
</li>
</ul>
<pre class="prettyprint linenums">
&lt;?php

class YourController
{
    /**
     * @ApiDoc(
     *     statusCodes={
     *         200="Returned when successful",
     *         403="Returned when the user is not authorized to say hello",
     *         404={
     *           "Returned when the user is not found",
     *           "Returned when somehting else is not found"
     *         }
     *     }
     * )
     */
    public function myFunction()
    {
        // ...
    }
}
</pre>

<p>这个bundle也可以通过定义的路由来获取信息，比如<code>requirements</code>, <code>pattern</code>, 等等，所以为了最好地使用这个bundle，你应该严格定义每个函数的requirements等信息。</p>
<p><em>本文翻译自<a href="https://github.com/nelmio/NelmioApiDocBundle" target="_blank" rel="external">NelmioApiDocBundle</a>的github主页的官方文档</em></p>
</div></article></div></section><footer><div class="paginator"><a href="/2013/08/17/Jekyll-bootstrap添加代码高亮/" class="prev">PRVE</a><a href="/2013/08/16/Symfony2-0-installation-and-configuration/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ZhipengJiang';
var disqus_identifier = '2013/08/17/Symfony2-2-NelmioApiDocBundle自动生成文档-译/';
var disqus_title = 'Symfony2 (2) - NelmioApiDocBundle自动生成文档(译)';
var disqus_url = 'http://yoursite.com/2013/08/17/Symfony2-2-NelmioApiDocBundle自动生成文档-译/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ZhipengJiang.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2016 <a href="http://yoursite.com">Zhipeng Jiang</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-47515905-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>